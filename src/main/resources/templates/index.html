<!DOCTYPE html>
<html
  lang="ko"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorator="layout/layout"
>
	<main layout:fragment="content">
	<!-- Page Content container -->
	<div class="gride">
	<div id="information" class="container">
		 <th:block th:unless="${#lists.isEmpty(searchHorse)}">
		  	<h1 class="my-4">경주마 정보</h1>
		  	<div class="row justify-content-md-center">
				<div class="col-sm-top">마명</div>
				<div class="col-sm-top">레이팅</div>
				<div class="col-sm-top">등급</div>
				<div class="col-sm-top">산지</div>
				<div class="col-sm-top">성별</div>
				<div class="col-sm-3-top">전적</div>
		    </div>	
			<!-- Marketing Icons Section -->
		    <div class="row justify-content-md-center" th:each="horse : ${searchHorse}">
				<div class="col-sm"><a th:onclick='horseDetail([[${horse.hrNo}]], [[${horse.trNo}]])' th:text="${horse.hrName}" href="#KRA" ></a></div>
				<div class="col-sm" th:text="${horse.rating}"></div>
				<div class="col-sm" th:text="${horse.ranks}"></div>
				<div class="col-sm" th:text="${horse.nation}"></div>
				<div class="col-sm" th:text="${horse.sex}"></div>
				<div class="col-sm-3" th:text="${horse.totalRecords}"></div>
		    </div>	
		 </th:block>
		 
		 <th:block th:unless="${#lists.isEmpty(searchTrainer)}">
		  	<h1 class="my-4">조교사 정보</h1>
		  	<div class="row justify-content-md-center">
				<div class="col-sm-top">조교사 이름</div>
				<div class="col-sm-top">소속조</div>
				<div class="col-sm-top">데뷔 날짜</div>
				<div class="col-md-4-top">통산 전적</div>
				<div class="col-sm-top">연승률</div>
				<div class="col-sm-top">복승률</div>
				<div class="col-sm-top">승률</div>  
		    </div>	
			<!-- Marketing Icons Section -->
		    <div class="row justify-content-md-center" th:each="tr : ${searchTrainer}">
				<div class="col-sm"><a th:onclick='trainerDetail([[${tr.trNo}]])' th:text="${tr.trName}" href="#KRA" ></a></div>
				<div class="col-sm" th:text="${tr.part}"></div>
				<div class="col-sm" th:text="${tr.debut}"></div>
				<div class="col-md-4" th:text="${tr.tAllTotal}"></div>
				<div class="col-sm" th:text="${tr.tConsecutiveWinningP}"></div>
				<div class="col-sm" th:text="${tr.tComplementRyRate}"></div>
				<div class="col-sm" th:text="${tr.tWinningP}"></div>  
		    </div>	
		 </th:block>
		 
		  <th:block th:unless="${#lists.isEmpty(searchJockey)}">
		  	<h1 class="my-4">기수 정보</h1>
		  	<div class="row justify-content-md-center">
				<div class="col-sm-top">기수 이름</div>
				<div class="col-sm-top">소속조</div>
				<div class="col-sm-top">데뷔 날짜</div>
				<div class="col-md-4-top">통산 전적</div>
				<div class="col-sm-top">연승률</div>
				<div class="col-sm-top">복승률</div>
				<div class="col-sm-top">승률</div>  
		    </div>	
			<!-- Marketing Icons Section -->
		    <div class="row justify-content-md-center" th:each="jk : ${searchJockey}">
				<div class="col-sm"><a th:onclick='jockeyDetail([[${jk.jkNo}]])' th:text="${jk.jkName}" href="#KRA"></a></div>
				<div class="col-sm" th:text="${jk.part}"></div>
				<div class="col-sm" th:text="${jk.debut}"></div>
				<div class="col-md-4" th:text="${jk.jAllTotal}"></div>
				<div class="col-sm" th:text="${jk.jConsecutiveWinningP}"></div>
				<div class="col-sm" th:text="${jk.jComplementRyRate}"></div>
				<div class="col-sm" th:text="${jk.jWinningP}"></div>  
		    </div>	
		 </th:block>
	</div>
	</div>
	<!-- Page Content container -->
</main>
	<th:block layout:fragment="script">
		<!-- Bootstrap core JavaScript -->
		<script src="/static/vendor/jquery/jquery.min.js"></script>
		<script src="/static/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
		<script>
			let token = $("meta[name='_csrf']").attr("content");
			let header = $("meta[name='_csrf_header']").attr("content");
	
			$(function() {
				$(document).ajaxSend(function(e, xhr, options) {
					xhr.setRequestHeader(header, token);
				});
			});
	
			$("#search").bind("keyup input", function(key) {
				let search = $("#search").val();
				let last_char = search.charAt(search.length - 1);
				console.log(last_char);
				if (key.keyCode !== 13) {
					console.log("recommend");
					console.log(key.keyCode);
					$.ajax({
						url : "/search/recommendWord",
						type : "POST",
						data : {
							"search" : search
						},
						dataType : "text",
						success : function(retVal) {
							$("#recommendWord").val("");
							$("#recommendWord").replaceWith(retVal);
						},
						error : function() {
							alert("error");
						}
					});
				} else if (search !== "") {
					console.log("search");
					console.log(key.keyCode);
					$.ajax({
						url : "/search",
						type : "POST",
						data : {
							"search" : search
						},
						dataType : "text",
						success : function(retVal) {
							$("#information").val("");
							$("#recommendWord").val("");
							$("#recommendList").remove();
							$("#information").replaceWith(retVal);
						},
						error : function() {
							alert("error");
						}
					});
				}
				;
			});
			
			$("#searchBtn").bind("click", function(){
				let search = $("#search").val();
				console.log(search);
				$.ajax({
					url : "/search",
					type : "POST",
					data : {
						"search" : search
					},
					dataType : "text",
					success : function(retVal) {
						$("#information").val("");
						$("#recommendWord").val("");
						$("#recommendList").remove();
						$("#information").replaceWith(retVal);
					},
					error : function() {
						alert("error");
					}
				});
			})
	
			function horseDetail(hrNo, trNo) {
	
				let form = document.createElement("form");
				form.setAttribute("method", "POST");
				form.setAttribute("action", "/horseDetail");
	
				let hiddenField1 = document.createElement("input");
				hiddenField1.setAttribute("type", "hidden");
				hiddenField1.setAttribute("name", "hrNo");
				hiddenField1.setAttribute("value", hrNo);
	
				let hiddenField2 = document.createElement("input");
				hiddenField2.setAttribute("type", "hidden");
				hiddenField2.setAttribute("name", "trNo");
				hiddenField2.setAttribute("value", trNo);
	
				let csrf1 = document.createElement("input");
				csrf1.setAttribute("type", "hidden");
				csrf1.setAttribute("name", "_csrf");
				csrf1.setAttribute("value", token);
	
				form.appendChild(csrf1);
				form.appendChild(hiddenField1);
				form.appendChild(hiddenField2);
	
				document.body.appendChild(form);
				form.submit();
			}
	
			function trainerDetail(trNo) {
	
				let form = document.createElement("form");
				form.setAttribute("method", "POST");
				form.setAttribute("action", "/trainerDetail");
	
				let hiddenField1 = document.createElement("input");
				hiddenField1.setAttribute("type", "hidden");
				hiddenField1.setAttribute("name", "trNo");
				hiddenField1.setAttribute("value", trNo);
	
				let csrf1 = document.createElement("input");
				csrf1.setAttribute("type", "hidden");
				csrf1.setAttribute("name", "_csrf");
				csrf1.setAttribute("value", token);
	
				form.appendChild(csrf1);
				form.appendChild(hiddenField1);
	
				document.body.appendChild(form);
				form.submit();
			}
	
			function jockeyDetail(jkNo) {
	
				let form = document.createElement("form");
				form.setAttribute("method", "POST");
				form.setAttribute("action", "/jockeyDetail");
	
				let hiddenField1 = document.createElement("input");
				hiddenField1.setAttribute("type", "hidden");
				hiddenField1.setAttribute("name", "jkNo");
				hiddenField1.setAttribute("value", jkNo);
	
				let csrf1 = document.createElement("input");
				csrf1.setAttribute("type", "hidden");
				csrf1.setAttribute("name", "_csrf");
				csrf1.setAttribute("value", token);
	
				form.appendChild(csrf1);
				form.appendChild(hiddenField1);
	
				document.body.appendChild(form);
				form.submit();
			}
		</script>
	</th:block>

